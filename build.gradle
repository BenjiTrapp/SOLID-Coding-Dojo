plugins {
    id 'java'
    id 'maven'
    id "groovy"
    id 'idea'
    id 'org.ajoberstar.grgit' version '2.2.0-rc.1'
}

group = 'de.benjitrapp.gpssimulator'
version = '1.0.0-SNAPSHOT'

description = """"""

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    jcenter()
    mavenCentral()
    maven { url "http://repo.maven.apache.org/maven2" }
}

idea {
    module {
        inheritOutputDirs = false
        outputDir = file('out/production/' + module.name)
        testOutputDir = file('out/test/' + module.name)
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '3.4.1'
}

def choice = 'master'

task ask(type: Task) {
    def console = System.console()
    if (console) {
        println """
                Welcome to the SOLID Coding Dojo!
                ======================================
                Available lessons
                
                S: Single responsibility principle
                O: Open/Close principle
                L: Liskov substitution principle
                I: Interface segregation principle
                D: Dependency inversion principle
                """
        choice = console.readLine('> Choose your destiny! : ').toLowerCase()
        assert choice.matches("^[solid]\$"), "Only the chars S,O,L,I,D are allowed!"
    } else {
        logger.error "ERROR: Can't get a valid console"
        ask.execute()
    }
}

task startLesson(type: Task) {
    startLesson.dependsOn(ask)

    grgit.checkout {
        branch = choice
        createBranch = false
    }
}

task getSolution(type: Task) {
    def currentBranch = grgit.branch.current().name

    println currentBranch
}

dependencies {
    compile "org.codehaus.groovy:groovy-all:2.4.10"

    testCompile('com.athaydes:spock-reports:1.3.1') {
        transitive = false // this avoids affecting your version of Groovy/Spock
    }

    testCompile(
            "org.spockframework:spock-core:1.1-groovy-2.4",
            //"org.hamcrest:hamcrest-all:1.3'"
    )

    testRuntime(
            "net.bytebuddy:byte-buddy:1.6.5",
            "org.objenesis:objenesis:2.5.1"
    )
}
